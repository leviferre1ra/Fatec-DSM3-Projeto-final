{% extends "allauth/layouts/base.html" %}

{% block content %}

<div class="m-0 font-[Inter] font-bold grid grid-cols-[450px_1fr] bg-white box-border">

  <!-- Painel lateral -->
  <aside class="bg-white flex flex-col p-[30px] overflow-y-scroll max-h-screen py-9 scrollbar shadow-[10px_0px_6px_rgba(0,0,0,0.15)] z-[2]">

    <!-- Perfil -->
    <div class="flex items-center gap-[10px] mb-[35px]">
      <img src="https://via.placeholder.com/45" alt="Foto do usuário"
           class="w-[65px] h-[65px] rounded-full object-cover border-[2.3px] border-black">
      <span class="font-medium text-black text-[1.2rem]">{{ user.first_name|default:user.username }}</span>
    </div>

    <!-- Contagem regressiva -->
    <div class="text-center mb-[18px]">
      <h2 class="m-0 text-black font-semibold text-[1.5rem]">A coleta começa em:</h2>
      <h1 class="text-[6.5rem] text-[#7083D9] font-bold m-0">00:47</h1>
    </div>

    <!-- Próxima coleta -->
    <div class="bg-[#7083D9] text-white rounded-[10px] p-4 text-center mb-[23px] shadow-[10px_10px_5px_rgba(0,0,0,0.15)] z-[3]">
      <p class="m-[5px_3px] text-[1.3rem] font-normal"><strong>Próxima Coleta:</strong> 28/09/2025</p>
      <p class="m-[5px_3px] text-[1.3rem] font-normal"><strong>Horário Previsto:</strong> 14:00</p>
    </div>

    <!-- Alerta -->
    <div class="text-center mb-[25px]">
      <h2 class="m-0 text-black font-semibold text-[1.5rem]">Perdeu o horário da coleta?</h2>
      <a href="#" class="text-[#7083D9] no-underline font-semibold text-[1.2rem] hover:underline">Crie um alerta para lembrar</a>
    </div>

    <!-- Contribuições e últimas coletas -->
    <div class="flex gap-[12px] items-stretch justify-between mb-[20px] w-full max-[420px]:flex-col">

      <!-- Contribuições -->
      <div class="bg-[#cbe74e] text-center font-semibold text-black rounded-[10px] p-[14px] shadow-[10px_10px_5px_rgba(0,0,0,0.15)] z-[3] flex-1">
        <p class="text-[0.9rem] mt-5 text-[#4e4e4e] font-bold">Você contribuiu com</p>
        <h1 class="text-[6rem] m-[8px_0]">15</h1>
        <p class="text-[0.9rem] text-[#4e4e4e] font-bold">Coletas</p>
      </div>

      <!-- Últimas coletas -->
      <div class="bg-[#ffb84d] text-[#4e4e4e] text-[0.92rem] rounded-[10px] p-[14px] shadow-[10px_10px_5px_rgba(0,0,0,0.15)] z-[3] flex-1 text-center">
        <h3 class=" text-black m-0 mb-[8px] text-[0.9rem]">Últimas coletas</h3>
        <ul class="list-none m-0 px-[6px] text-[#4e4e4e">
          <li class="py-[4px] font-medium border-b border-dashed border-[rgba(0,0,0,0.06)]">21/09/2025</li>
          <li class="py-[4px] font-medium border-b border-dashed border-[rgba(0,0,0,0.06)]">13/09/2025</li>
          <li class="py-[4px] font-medium border-b border-dashed border-[rgba(0,0,0,0.06)]">06/09/2025</li>
          <li class="py-[4px] font-medium border-b border-dashed border-[rgba(0,0,0,0.06)]">01/08/2025</li>
          <li class="py-[4px] font-medium border-b border-dashed border-[rgba(0,0,0,0.06)]">XX/XX/2025</li>
          <li class="py-[4px] font-medium border-b border-dashed border-[rgba(0,0,0,0.06)]">XX/XX/2025</li>
          <li class="py-[4px] font-medium">XX/XX/2025</li>
        </ul>
      </div>
    </div>

      <!-- Rodapé -->
    <footer class="text-center text-[0.9rem] mt-auto font-semibold text-[#4e4e4e]">
      Precisa de ajuda? <a href="#" class="text-[#7083D9] no-underline hover:underline">Clique aqui</a>
    </footer>
  </aside>

  <!-- Mapa -->
  <main class="w-full h-full z-[1]">
    <div id="map" class="w-full h-screen"></div>
  </main>
</div>

<!-- Leaflet CSS e JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // Inicializar mapa
   const map = L.map('map').setView([-24.0053, -46.4124], 15);

  // Adicionar tile layer
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors',
    maxZoom: 19
  }).addTo(map);


  // Layer GeoJSON para as zonas de coleta
  const geoJsonLayer = L.geoJSON(null, {
    style: function(feature) {
      return {
        color: '#7083D9',
        weight: 2,
        opacity: 0.8,
        fillOpacity: 0.3,
        fillColor: '#7083D9'
      };
    },
    onEachFeature: function(feature, layer) {
      const props = feature.properties;
      const dias = props.Dias.join(', ');
      const popupContent = `
        <div class="popup-content">
          <b>${props.Bairro}</b><br>
          <strong>Dias:</strong> ${dias}<br>
          <strong>Período:</strong> ${props.Período}<br>
          <strong>Horário:</strong> ${props.Horário}
        </div>
      `;
      layer.bindPopup(popupContent);
    }
  }).addTo(map);

  // Dados GeoJSON passados do backend
  const geojsonData = {{ geojson|safe }};
  geoJsonLayer.addData(geojsonData);
</script>

{% endblock content %}